<html>
<head>
  <title></title>
</head>
<body>

  <h3>Guest</h3>

  <script type="text/javascript">
    window.postMessage = null;
  </script>
  <script src="porthole.js"></script>

  <script type="text/javascript">
    window.onload=function(){

      var hash = decodeURIComponent(location.hash.substr(0)),
          m = hash.match(/PARENT=(.*)/),
          parentProxy =  m && m[1],
          type = !parentProxy ? 'relay' : 'child';

      console.log(type, location.origin, parentProxy);

      if(type === 'relay') {
        Porthole.WindowProxyDispatcher.start();
        return;
      }

      // Create a proxy window to send to and receive 
      // messages from the iFrame
      window.windowProxy = new Porthole.WindowProxy(parentProxy);

      // Register an event handler to receive messages;
      windowProxy.addEventListener(function(e) {

        console.log(e.origin, '=>', location.origin, e.data);

      });
    };
  </script>

</body>
</html>