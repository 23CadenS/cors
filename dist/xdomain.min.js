/** XDomain - v0.0.1 - 2013/04/09
 * 
 * Copyright (c) 2013 Jaime Pillora - MIT
 */
(function(t,r){(function(){"use strict";var n,o,i,a,s,u,l;a=function(r){return console&&console.log?console.log("xdomain",t.location.host,": ",r):undefined},a("init client"),l={},s=function(t,n){var e,i,a,s;return l[t]?l[t]:(e=r.createElement("iframe"),i=o(),e.id=i,e.name=i,a=t+n,e.src=a,s=e.contentWindow,$("body").append(e),l[t]=s,s)},$(t).on("message",function(t){var r,n,o;return o=t.data,r=o.id,n=$.ajax(o.ajax),n.always(function(){var n;return n={id:r,args:arguments},t.source.postMessage(n,e.origin)})}),n=function(){function r(r,n){var e,l,c,p;if(this.ajaxOpts=r,null==n&&(n={}),!r)throw"ajax options required";if(!r.url)throw"url required";if(this.url=r.url,this.origin=u(this.url).origin,!this.origin)throw"invalid url";this.opts=i(this.defaults,n),this.proxy=s(this.opts.localProxy,this.opts.remoteProxy,this.origin),e=$.Deferred(),c=o(),p=setInterval(function(){try{this.proxy.postMessage({id:c,ajax:this.ajaxOpts})}catch(t){return}return clearInterval(p)},50),l=function(){return a("got result"),e.resolve(),$(t).off("message",l)},$(t).on("message",l),this.d=e.promise()}return r.prototype.frames={},r.prototype.proxies={},r.prototype.defaults={localProxy:"/xdomain/example/proxy.html",remoteProxy:"/xdomain/example/proxy.html"},r}(),$.xdomain=function(t){return $.extend(n.prototype.defaults,t)},$.xdomain.ajax=function(t,r){var o;return o=new n(t,r),o.d},o=function(){return(Math.random()*Math.pow(2,32)).toString(16)},u=function(t){var r;return r=t.match(/(https?:\/\/[^\/]+)(\/.*)/),r&&{origin:r[1],path:r[2]}},i=function(t,r){var n;return n=function(){},n.prototype=t,$.extend(!0,new n,r)}}).call(this)})(window,document);