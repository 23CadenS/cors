/** XDomain - v0.0.1 - 2013/04/09
 * 
 * Copyright (c) 2013 Jaime Pillora - MIT
 */
(function(t,o){(function(){"use strict";var r,n,e,i,u,a,s,l;u=function(o){return console&&console.log?console.log("xdomain",t.location.host,": ",o):undefined},u("init"),n={},l={},a=function(r,i,u){var a,s,p,c;return l[u]?l[u]:(a=o.createElement("iframe"),s=e(),a.id=s,a.name=s,c=u+i,p=r?t.location.origin+r:"",a.src=c+"#"+p,n[u]=a,$("body").append(a),l[u]=proxy,proxy)},r=function(){function t(t,o){var r=this;if(this.ajaxOpts=t,null==o&&(o={}),!t)throw"ajax options required";if(!t.url)throw"url required";if(this.url=t.url,this.origin=s(this.url).origin,!this.origin)throw"invalid url";this.opts=i(this.defaults,o),this.proxy=a(this.opts.localProxy,this.opts.remoteProxy,this.origin),this.run(),setTimeout(function(){return u("fire!"),r.proxy.post("test")},2e3)}return t.prototype.frames={},t.prototype.proxies={},t.prototype.defaults={localProxy:"/xdomain/example/proxy.html",remoteProxy:"/xdomain/example/proxy.html"},t.prototype.run=function(){var t;return t=$.Deferred(),this.d=t.promise()},t}(),$(o).ready(function(){var o,r,n,e,i;return Porthole.WindowProxyDispatcher.start(),(o=t.location.hash.substr(1))?(i=s(o),r=i.origin,n=i.path,e=a(null,n,r),e.addEventListener(function(){return console.log(arguments)}),setTimeout(function(){return u("fire!"),e.post("test")},2e3)):undefined}),$.xdomain=function(t){return $.extend(r.prototype.defaults,t)},$.xdomain.ajax=function(t,o){var n;return n=new r(t,o),n.d},e=function(){return(Math.random()*Math.pow(2,32)).toString(16)},s=function(t){var o;return o=t.match(/(https?:\/\/[^\/]+)(\/.*)/),o&&{origin:o[1],path:o[2]}},i=function(t,o){var r;return r=function(){},r.prototype=t,$.extend(!0,new r,o)}}).call(this)})(window,document);