{"version":3,"sources":["vendor/xhook.js","lib/config.js","lib/util.js","lib/slave.js","lib/socket.js","lib/master.js","lib/script.js","index.js","browser.js"],"names":["AFTER","BEFORE","COMMON_EVENTS","EventEmitter","FIRE","FormData","NativeFormData","NativeXMLHttp","OFF","ON","READY_STATE","UPLOAD_EVENTS","XHookFormData","XHookHttpRequest","XMLHTTP","convertHeaders","depricatedProp","document","fakeEvent","mergeObjects","msie","proxyEvents","slice","xhook","_base","__indexOf","indexOf","item","i","l","length","window","parseInt","exec","navigator","userAgent","toLowerCase","isNaN","Array","prototype","x","_i","_len","o","n","call","p","src","dst","k","v","_error","events","event","e","clone","val","_has","type","msieEventObject","createEventObject","Event","nodeStyle","emitter","listeners","callback","undefined","splice","args","legacylistener","listener","_ref","arguments","shift","apply","concat","on","off","fire","once","fn","destroy","handler","enable","disable","headers","h","dest","header","name","value","push","join","split","test","RegExp","$1","$2","form","entries","fd","Object","defineProperty","get","fentries","querySelectorAll","filter","checked","map","files","append","_this","ABORTED","currentState","emitFinal","emitReadyState","facade","hasError","hasErrorHandler","readBody","readHead","request","response","setReadyState","status","transiting","writeBody","writeHead","xhr","key","statusText","getAllResponseHeaders","responseType","text","responseText","data","xml","responseXML","finalUrl","responseURL","setTimeout","hooks","process","hook","async","onreadystatechange","addWithCredentials","withCredentials","open","method","url","user","pass","headerNames","send","body","modk","_j","_len1","_ref1","_k","_len2","_ref2","_ref3","upload","setRequestHeader","done","userResponse","head","progress","abort","lName","getResponseHeader","overrideMimeType","module","exports","config","masters","slaves","debug","timeout","cookies","master","slave","require","COMPAT_VERSION","location","currentOrigin","protocol","host","origin","globalEmitter","console","counter","guid","String","newLogger","msg","alert","log","warn","instOf","obj","global","parseUrl","path","$3","toRegExp","str","toString","replace","strip","includes","enabled","addMasters","parent","postMessage","handleSocket","socket","pathRegex","regex","masterRegex","error","req","close","XMLHttpRequest","addEventListener","emit","readyState","resp","error1","slaveCookie","cookie","from","blob","Blob","id","CHECK_STRING","CHECK_INTERVAL","sockets","jsonEncode","createSocket","frame","ready","pendingEmits","extra","unshift","JSON","stringify","checks","check","initialise","handle","d","parse","source","attachEvent","socketlib","addSlaves","before","beforeXHR","newSlaves","getFrame","handleRequest","frames","proxyPath","createElement","setAttribute","appendChild","contentWindow","convertToArrayBuffer","isBlob","isFile","reader","FileReader","onload","result","readAsArrayBuffer","convertFormData","forEach","file","c","newargs","dispatchEvent","attrs","s","m","getElementsByTagName","script","prefix","getAttribute","feature","xdomain"],"mappings":"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","file":"xdomain.map","sourcesContent":["// XHook - v1.3.5 - https://github.com/jpillora/xhook\n// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2016\n\nvar AFTER,\n  BEFORE,\n  COMMON_EVENTS,\n  EventEmitter,\n  FIRE,\n  FormData,\n  NativeFormData,\n  NativeXMLHttp,\n  OFF,\n  ON,\n  READY_STATE,\n  UPLOAD_EVENTS,\n  XHookFormData,\n  XHookHttpRequest,\n  XMLHTTP,\n  convertHeaders,\n  depricatedProp,\n  document,\n  fakeEvent,\n  mergeObjects,\n  msie,\n  proxyEvents,\n  slice,\n  xhook,\n  _base,\n  __indexOf =\n    [].indexOf ||\n    function(item) {\n      for (var i = 0, l = this.length; i < l; i++) {\n        if (i in this && this[i] === item) return i;\n      }\n      return -1;\n    };\n\ndocument = window.document;\n\nBEFORE = \"before\";\n\nAFTER = \"after\";\n\nREADY_STATE = \"readyState\";\n\nON = \"addEventListener\";\n\nOFF = \"removeEventListener\";\n\nFIRE = \"dispatchEvent\";\n\nXMLHTTP = \"XMLHttpRequest\";\n\nFormData = \"FormData\";\n\nUPLOAD_EVENTS = [\"load\", \"loadend\", \"loadstart\"];\n\nCOMMON_EVENTS = [\"progress\", \"abort\", \"error\", \"timeout\"];\n\nmsie = parseInt(\n  (/msie (\\d+)/.exec(navigator.userAgent.toLowerCase()) || [])[1]\n);\n\nif (isNaN(msie)) {\n  msie = parseInt(\n    (/trident\\/.*; rv:(\\d+)/.exec(navigator.userAgent.toLowerCase()) || [])[1]\n  );\n}\n\n(_base = Array.prototype).indexOf ||\n  (_base.indexOf = function(item) {\n    var i, x, _i, _len;\n    for (i = _i = 0, _len = this.length; _i < _len; i = ++_i) {\n      x = this[i];\n      if (x === item) {\n        return i;\n      }\n    }\n    return -1;\n  });\n\nslice = function(o, n) {\n  return Array.prototype.slice.call(o, n);\n};\n\ndepricatedProp = function(p) {\n  return p === \"returnValue\" || p === \"totalSize\" || p === \"position\";\n};\n\nmergeObjects = function(src, dst) {\n  var k, v;\n  for (k in src) {\n    v = src[k];\n    if (depricatedProp(k)) {\n      continue;\n    }\n    try {\n      dst[k] = src[k];\n    } catch (_error) {}\n  }\n  return dst;\n};\n\nproxyEvents = function(events, src, dst) {\n  var event, p, _i, _len;\n  p = function(event) {\n    return function(e) {\n      var clone, k, val;\n      clone = {};\n      for (k in e) {\n        if (depricatedProp(k)) {\n          continue;\n        }\n        val = e[k];\n        clone[k] = val === src ? dst : val;\n      }\n      return dst[FIRE](event, clone);\n    };\n  };\n  for (_i = 0, _len = events.length; _i < _len; _i++) {\n    event = events[_i];\n    if (dst._has(event)) {\n      src[\"on\" + event] = p(event);\n    }\n  }\n};\n\nfakeEvent = function(type) {\n  var msieEventObject;\n  if (document.createEventObject != null) {\n    msieEventObject = document.createEventObject();\n    msieEventObject.type = type;\n    return msieEventObject;\n  } else {\n    try {\n      return new Event(type);\n    } catch (_error) {\n      return {\n        type: type\n      };\n    }\n  }\n};\n\nEventEmitter = function(nodeStyle) {\n  var emitter, events, listeners;\n  events = {};\n  listeners = function(event) {\n    return events[event] || [];\n  };\n  emitter = {};\n  emitter[ON] = function(event, callback, i) {\n    events[event] = listeners(event);\n    if (events[event].indexOf(callback) >= 0) {\n      return;\n    }\n    i = i === undefined ? events[event].length : i;\n    events[event].splice(i, 0, callback);\n  };\n  emitter[OFF] = function(event, callback) {\n    var i;\n    if (event === undefined) {\n      events = {};\n      return;\n    }\n    if (callback === undefined) {\n      events[event] = [];\n    }\n    i = listeners(event).indexOf(callback);\n    if (i === -1) {\n      return;\n    }\n    listeners(event).splice(i, 1);\n  };\n  emitter[FIRE] = function() {\n    var args, event, i, legacylistener, listener, _i, _len, _ref;\n    args = slice(arguments);\n    event = args.shift();\n    if (!nodeStyle) {\n      args[0] = mergeObjects(args[0], fakeEvent(event));\n    }\n    legacylistener = emitter[\"on\" + event];\n    if (legacylistener) {\n      legacylistener.apply(emitter, args);\n    }\n    _ref = listeners(event).concat(listeners(\"*\"));\n    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n      listener = _ref[i];\n      listener.apply(emitter, args);\n    }\n  };\n  emitter._has = function(event) {\n    return !!(events[event] || emitter[\"on\" + event]);\n  };\n  if (nodeStyle) {\n    emitter.listeners = function(event) {\n      return slice(listeners(event));\n    };\n    emitter.on = emitter[ON];\n    emitter.off = emitter[OFF];\n    emitter.fire = emitter[FIRE];\n    emitter.once = function(e, fn) {\n      var fire;\n      fire = function() {\n        emitter.off(e, fire);\n        return fn.apply(null, arguments);\n      };\n      return emitter.on(e, fire);\n    };\n    emitter.destroy = function() {\n      return (events = {});\n    };\n  }\n  return emitter;\n};\n\nxhook = EventEmitter(true);\n\nxhook.EventEmitter = EventEmitter;\n\nxhook[BEFORE] = function(handler, i) {\n  if (handler.length < 1 || handler.length > 2) {\n    throw \"invalid hook\";\n  }\n  return xhook[ON](BEFORE, handler, i);\n};\n\nxhook[AFTER] = function(handler, i) {\n  if (handler.length < 2 || handler.length > 3) {\n    throw \"invalid hook\";\n  }\n  return xhook[ON](AFTER, handler, i);\n};\n\nxhook.enable = function() {\n  window[XMLHTTP] = XHookHttpRequest;\n  if (NativeFormData) {\n    window[FormData] = XHookFormData;\n  }\n};\n\nxhook.disable = function() {\n  window[XMLHTTP] = xhook[XMLHTTP];\n  if (NativeFormData) {\n    window[FormData] = NativeFormData;\n  }\n};\n\nconvertHeaders = xhook.headers = function(h, dest) {\n  var header, headers, k, name, v, value, _i, _len, _ref;\n  if (dest == null) {\n    dest = {};\n  }\n  switch (typeof h) {\n    case \"object\":\n      headers = [];\n      for (k in h) {\n        v = h[k];\n        name = k.toLowerCase();\n        headers.push(\"\" + name + \":\\t\" + v);\n      }\n      return headers.join(\"\\n\");\n    case \"string\":\n      headers = h.split(\"\\n\");\n      for (_i = 0, _len = headers.length; _i < _len; _i++) {\n        header = headers[_i];\n        if (/([^:]+):\\s*(.+)/.test(header)) {\n          name = (_ref = RegExp.$1) != null ? _ref.toLowerCase() : void 0;\n          value = RegExp.$2;\n          if (dest[name] == null) {\n            dest[name] = value;\n          }\n        }\n      }\n      return dest;\n  }\n};\n\nNativeFormData = window[FormData];\n\nXHookFormData = function(form) {\n  var entries;\n  this.fd = form ? new NativeFormData(form) : new NativeFormData();\n  this.form = form;\n  entries = [];\n  Object.defineProperty(this, \"entries\", {\n    get: function() {\n      var fentries;\n      fentries = !form\n        ? []\n        : slice(form.querySelectorAll(\"input,select\"))\n            .filter(function(e) {\n              var _ref;\n              return (\n                ((_ref = e.type) !== \"checkbox\" && _ref !== \"radio\") ||\n                e.checked\n              );\n            })\n            .map(function(e) {\n              return [e.name, e.type === \"file\" ? e.files : e.value];\n            });\n      return fentries.concat(entries);\n    }\n  });\n  this.append = (function(_this) {\n    return function() {\n      var args;\n      args = slice(arguments);\n      entries.push(args);\n      return _this.fd.append.apply(_this.fd, args);\n    };\n  })(this);\n};\n\nif (NativeFormData) {\n  xhook[FormData] = NativeFormData;\n  window[FormData] = XHookFormData;\n}\n\nNativeXMLHttp = window[XMLHTTP];\n\nxhook[XMLHTTP] = NativeXMLHttp;\n\nXHookHttpRequest = window[XMLHTTP] = function() {\n  var ABORTED,\n    currentState,\n    emitFinal,\n    emitReadyState,\n    event,\n    facade,\n    hasError,\n    hasErrorHandler,\n    readBody,\n    readHead,\n    request,\n    response,\n    setReadyState,\n    status,\n    transiting,\n    writeBody,\n    writeHead,\n    xhr,\n    _i,\n    _len,\n    _ref;\n  ABORTED = -1;\n  xhr = new xhook[XMLHTTP]();\n  request = {};\n  status = null;\n  hasError = void 0;\n  transiting = void 0;\n  response = void 0;\n  readHead = function() {\n    var key, name, val, _ref;\n    response.status = status || xhr.status;\n    if (!(status === ABORTED && msie < 10)) {\n      response.statusText = xhr.statusText;\n    }\n    if (status !== ABORTED) {\n      _ref = convertHeaders(xhr.getAllResponseHeaders());\n      for (key in _ref) {\n        val = _ref[key];\n        if (!response.headers[key]) {\n          name = key.toLowerCase();\n          response.headers[name] = val;\n        }\n      }\n    }\n  };\n  readBody = function() {\n    if (!xhr.responseType || xhr.responseType === \"text\") {\n      response.text = xhr.responseText;\n      response.data = xhr.responseText;\n    } else if (xhr.responseType === \"document\") {\n      response.xml = xhr.responseXML;\n      response.data = xhr.responseXML;\n    } else {\n      response.data = xhr.response;\n    }\n    if (\"responseURL\" in xhr) {\n      response.finalUrl = xhr.responseURL;\n    }\n  };\n  writeHead = function() {\n    facade.status = response.status;\n    facade.statusText = response.statusText;\n  };\n  writeBody = function() {\n    if (\"text\" in response) {\n      facade.responseText = response.text;\n    }\n    if (\"xml\" in response) {\n      facade.responseXML = response.xml;\n    }\n    if (\"data\" in response) {\n      facade.response = response.data;\n    }\n    if (\"finalUrl\" in response) {\n      facade.responseURL = response.finalUrl;\n    }\n  };\n  emitReadyState = function(n) {\n    while (n > currentState && currentState < 4) {\n      facade[READY_STATE] = ++currentState;\n      if (currentState === 1) {\n        facade[FIRE](\"loadstart\", {});\n      }\n      if (currentState === 2) {\n        writeHead();\n      }\n      if (currentState === 4) {\n        writeHead();\n        writeBody();\n      }\n      facade[FIRE](\"readystatechange\", {});\n      if (currentState === 4) {\n        setTimeout(emitFinal, 0);\n      }\n    }\n  };\n  emitFinal = function() {\n    if (!hasError) {\n      facade[FIRE](\"load\", {});\n    }\n    facade[FIRE](\"loadend\", {});\n    if (hasError) {\n      facade[READY_STATE] = 0;\n    }\n  };\n  currentState = 0;\n  setReadyState = function(n) {\n    var hooks, process;\n    if (n !== 4) {\n      emitReadyState(n);\n      return;\n    }\n    hooks = xhook.listeners(AFTER);\n    process = function() {\n      var hook;\n      if (!hooks.length) {\n        return emitReadyState(4);\n      }\n      hook = hooks.shift();\n      if (hook.length === 2) {\n        hook(request, response);\n        return process();\n      } else if (hook.length === 3 && request.async) {\n        return hook(request, response, process);\n      } else {\n        return process();\n      }\n    };\n    process();\n  };\n  facade = request.xhr = EventEmitter();\n  xhr.onreadystatechange = function(event) {\n    try {\n      if (xhr[READY_STATE] === 2) {\n        readHead();\n      }\n    } catch (_error) {}\n    if (xhr[READY_STATE] === 4) {\n      transiting = false;\n      readHead();\n      readBody();\n    }\n    setReadyState(xhr[READY_STATE]);\n  };\n  hasErrorHandler = function() {\n    hasError = true;\n  };\n  facade[ON](\"error\", hasErrorHandler);\n  facade[ON](\"timeout\", hasErrorHandler);\n  facade[ON](\"abort\", hasErrorHandler);\n  facade[ON](\"progress\", function() {\n    if (currentState < 3) {\n      setReadyState(3);\n    } else {\n      facade[FIRE](\"readystatechange\", {});\n    }\n  });\n  if (\"withCredentials\" in xhr || xhook.addWithCredentials) {\n    facade.withCredentials = false;\n  }\n  facade.status = 0;\n  _ref = COMMON_EVENTS.concat(UPLOAD_EVENTS);\n  for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n    event = _ref[_i];\n    facade[\"on\" + event] = null;\n  }\n  facade.open = function(method, url, async, user, pass) {\n    currentState = 0;\n    hasError = false;\n    transiting = false;\n    request.headers = {};\n    request.headerNames = {};\n    request.status = 0;\n    response = {};\n    response.headers = {};\n    request.method = method;\n    request.url = url;\n    request.async = async !== false;\n    request.user = user;\n    request.pass = pass;\n    setReadyState(1);\n  };\n  facade.send = function(body) {\n    var hooks, k, modk, process, send, _j, _len1, _ref1;\n    _ref1 = [\"type\", \"timeout\", \"withCredentials\"];\n    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n      k = _ref1[_j];\n      modk = k === \"type\" ? \"responseType\" : k;\n      if (modk in facade) {\n        request[k] = facade[modk];\n      }\n    }\n    request.body = body;\n    send = function() {\n      var header, value, _k, _len2, _ref2, _ref3;\n      proxyEvents(COMMON_EVENTS, xhr, facade);\n      if (facade.upload) {\n        proxyEvents(\n          COMMON_EVENTS.concat(UPLOAD_EVENTS),\n          xhr.upload,\n          facade.upload\n        );\n      }\n      transiting = true;\n      xhr.open(\n        request.method,\n        request.url,\n        request.async,\n        request.user,\n        request.pass\n      );\n      _ref2 = [\"type\", \"timeout\", \"withCredentials\"];\n      for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n        k = _ref2[_k];\n        modk = k === \"type\" ? \"responseType\" : k;\n        if (k in request) {\n          xhr[modk] = request[k];\n        }\n      }\n      _ref3 = request.headers;\n      for (header in _ref3) {\n        value = _ref3[header];\n        if (header) {\n          xhr.setRequestHeader(header, value);\n        }\n      }\n      if (request.body instanceof XHookFormData) {\n        request.body = request.body.fd;\n      }\n      xhr.send(request.body);\n    };\n    hooks = xhook.listeners(BEFORE);\n    process = function() {\n      var done, hook;\n      if (!hooks.length) {\n        return send();\n      }\n      done = function(userResponse) {\n        if (\n          typeof userResponse === \"object\" &&\n          (typeof userResponse.status === \"number\" ||\n            typeof response.status === \"number\")\n        ) {\n          mergeObjects(userResponse, response);\n          if (__indexOf.call(userResponse, \"data\") < 0) {\n            userResponse.data = userResponse.response || userResponse.text;\n          }\n          setReadyState(4);\n          return;\n        }\n        process();\n      };\n      done.head = function(userResponse) {\n        mergeObjects(userResponse, response);\n        return setReadyState(2);\n      };\n      done.progress = function(userResponse) {\n        mergeObjects(userResponse, response);\n        return setReadyState(3);\n      };\n      hook = hooks.shift();\n      if (hook.length === 1) {\n        return done(hook(request));\n      } else if (hook.length === 2 && request.async) {\n        return hook(request, done);\n      } else {\n        return done();\n      }\n    };\n    process();\n  };\n  facade.abort = function() {\n    status = ABORTED;\n    if (transiting) {\n      xhr.abort();\n    } else {\n      facade[FIRE](\"abort\", {});\n    }\n  };\n  facade.setRequestHeader = function(header, value) {\n    var lName, name;\n    lName = header != null ? header.toLowerCase() : void 0;\n    name = request.headerNames[lName] = request.headerNames[lName] || header;\n    if (request.headers[name]) {\n      value = request.headers[name] + \", \" + value;\n    }\n    request.headers[name] = value;\n  };\n  facade.getResponseHeader = function(header) {\n    var name;\n    name = header != null ? header.toLowerCase() : void 0;\n    return response.headers[name];\n  };\n  facade.getAllResponseHeaders = function() {\n    return convertHeaders(response.headers);\n  };\n  if (xhr.overrideMimeType) {\n    facade.overrideMimeType = function() {\n      return xhr.overrideMimeType.apply(xhr, arguments);\n    };\n  }\n  if (xhr.upload) {\n    facade.upload = request.upload = EventEmitter();\n  }\n  return facade;\n};\n\nmodule.exports = xhook;\n","const config = o => {\n  if (o) {\n    if (o.masters) {\n      config.masters(o.masters);\n    }\n    if (o.slaves) {\n      config.slaves(o.slaves);\n    }\n  }\n};\n\n//default config\nconfig.debug = false;\nconfig.timeout = 15e3;\nconfig.cookies = {\n  master: \"Master-Cookie\",\n  slave: \"Slave-Cookie\"\n};\n//extras are also attached to config\n\nmodule.exports = config;\n","const xhook = require(\"../vendor/xhook\");\n\nconst config = require(\"./config\");\n\nexports.COMPAT_VERSION = \"V1\";\n\nconst { location } = window;\nexports.currentOrigin = location.protocol + \"//\" + location.host;\nconfig.origin = exports.currentOrigin;\n\n//emits 'warn' 'log' and 'timeout' events\nexports.globalEmitter = xhook.EventEmitter(true);\n\nexports.console = window.console || {};\n\nlet counter = 0;\nexports.guid = () => {\n  if (counter >= 1e6) counter = 0;\n  let n = String(++counter);\n  while (n.length < 6) n = \"0\" + n;\n  return `xdomain-${n}`;\n};\n\nexports.slice = (o, n) => {\n  return Array.prototype.slice.call(o, n);\n};\n\n//create a logger of type\nconst newLogger = type => {\n  return msg => {\n    msg = `xdomain (${exports.currentOrigin}): ${msg}`;\n    //emit event\n    exports.globalEmitter.fire(type, msg);\n    //skip logs when debug isnt enabled\n    if (type === \"log\" && !config.debug) {\n      return;\n    }\n    //user provided log/warn functions\n    if (type in config) {\n      config[type](msg);\n      //fallback console\n    } else if (type in console) {\n      console[type](msg);\n      //fallbackback alert\n    } else if (type === \"warn\") {\n      alert(msg);\n    }\n  };\n};\n\nexports.log = newLogger(\"log\");\nexports.warn = newLogger(\"warn\");\n\nexports.instOf = (obj, global) => {\n  return global in window && obj instanceof window[global];\n};\n\n//absolute url parser (relative urls aren't crossdomain)\nexports.parseUrl = url => {\n  if (/^((https?:)?\\/\\/[^\\/\\?]+)(\\/.*)?/.test(url)) {\n    return {\n      origin: (RegExp.$2 ? \"\" : location.protocol) + RegExp.$1,\n      path: RegExp.$3\n    };\n  } else {\n    exports.log(`failed to parse absolute url: ${url}`);\n    return null;\n  }\n};\nconfig.parseUrl = exports.parseUrl;\n\nexports.toRegExp = obj => {\n  if (obj instanceof RegExp) {\n    return obj;\n  }\n  const str = obj\n    .toString()\n    .replace(/\\W/g, str => `\\\\${str}`)\n    .replace(/\\\\\\*/g, \".*\");\n  return new RegExp(`^${str}$`);\n};\n\n//strip functions and objects from an object\nexports.strip = src => {\n  const dst = {};\n  for (let k in src) {\n    if (k === \"returnValue\") {\n      continue;\n    }\n    const v = src[k];\n    if (![\"function\", \"object\"].includes(typeof v)) {\n      dst[k] = v;\n    }\n  }\n  return dst;\n};\n","const xhook = require(\"../vendor/xhook\");\nconst config = require(\"./config\");\nconst {\n  log,\n  warn,\n  toRegExp,\n  strip,\n  parseUrl,\n  COMPAT_VERSION\n} = require(\"./util\");\n\n//when you add masters, this node\n//enables slave listeners\n\nlet enabled = false;\nlet masters = {};\n\nexports.addMasters = config => {\n  //validate iframe\n  if (window === window.parent) {\n    warn(\"slaves must be in an iframe\");\n    return;\n  }\n  //enable slave handler\n  if (!enabled) {\n    enabled = true;\n    log(\"now handling incoming sockets...\");\n    window.parent.postMessage(`XDPING_${COMPAT_VERSION}`, \"*\");\n  }\n  //white-list the provided set of masters\n  for (let origin in config) {\n    let path = config[origin];\n    if (origin === \"file://\" && path !== \"*\") {\n      warn(`file protocol only supports the * path`);\n      path = \"*\";\n    }\n    log(`adding master: ${origin}`);\n    masters[origin] = path;\n  }\n};\n\nconfig.masters = exports.addMasters;\n\nexports.handleSocket = (origin, socket) => {\n  if (!enabled) {\n    return;\n  }\n  //null means no origin can be determined,\n  //this is true for file:// and data:// URIs.\n  //html data:// URI are now blocked, they can\n  //only be copy-and-pasted into the URL bar.\n  if (origin === \"null\") {\n    origin = \"file://\";\n  }\n  log(`handle socket for \"${origin}\"`);\n  let pathRegex = null;\n  for (let master in masters) {\n    const regex = masters[master];\n    try {\n      const masterRegex = toRegExp(master);\n      if (masterRegex.test(origin)) {\n        pathRegex = toRegExp(regex);\n        break;\n      }\n    } catch (error) {}\n  }\n  if (!pathRegex) {\n    warn(`blocked request from: '${origin}'`);\n    return;\n  }\n  socket.once(\"request\", function(req) {\n    log(`request: ${req.method} ${req.url}`);\n    const p = parseUrl(req.url);\n    if (!p || !pathRegex.test(p.path)) {\n      warn(`blocked request to path: '${p.path}' by regex: ${pathRegex}`);\n      socket.close();\n      return;\n    }\n    //perform real XHR here!\n    //pass results to the socket\n    const xhr = new XMLHttpRequest();\n    xhr.open(req.method, req.url);\n    xhr.addEventListener(\"*\", e => socket.emit(\"xhr-event\", e.type, strip(e)));\n    if (xhr.upload) {\n      xhr.upload.addEventListener(\"*\", e =>\n        socket.emit(\"xhr-upload-event\", e.type, strip(e))\n      );\n    }\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState !== 4) {\n        return;\n      }\n      //extract properties\n      const resp = {\n        status: xhr.status,\n        statusText: xhr.statusText,\n        data: xhr.response,\n        headers: xhook.headers(xhr.getAllResponseHeaders())\n      };\n      try {\n        resp.text = xhr.responseText;\n      } catch (error1) {}\n      // XML over postMessage not supported\n      // try resp.xml = xhr.responseXML\n      return socket.emit(\"response\", resp);\n    };\n    //allow aborts from the facade\n    socket.once(\"abort\", () => xhr.abort());\n    // document.cookie (Cookie header) can't be set inside an iframe\n    // as many browsers have 3rd party cookies disabled. slaveCookie\n    // contains the 'xdomain.cookie.slave' string set on the master.\n    if (req.withCredentials) {\n      xhr.withCredentials = true;\n      if (req.slaveCookie) {\n        req.headers[req.slaveCookie] = document.cookie;\n      }\n    }\n    if (req.timeout) {\n      xhr.timeout = req.timeout;\n    }\n    if (req.type) {\n      xhr.responseType = req.type;\n    }\n    for (let k in req.headers) {\n      const v = req.headers[k];\n      xhr.setRequestHeader(k, v);\n    }\n    //deserialize FormData\n    if (req.body instanceof Array && req.body[0] === \"XD_FD\") {\n      const fd = new xhook.FormData();\n      const entries = req.body[1];\n      for (let args of Array.from(entries)) {\n        //deserialize blobs from arraybuffs\n        //[0:marker, 1:real-args, 2:arraybuffer, 3:type]\n        if (args[0] === \"XD_BLOB\" && args.length === 4) {\n          const blob = new Blob([args[2]], { type: args[3] });\n          args = args[1];\n          args[1] = blob;\n        }\n        fd.append.apply(fd, args);\n      }\n      req.body = fd;\n    }\n    //fire off request\n    xhr.send(req.body || null);\n  });\n  log(`slave listening for requests on socket: ${socket.id}`);\n};\n","const xhook = require(\"../vendor/xhook\");\n\nconst config = require(\"./config\");\nconst { globalEmitter, log, warn, COMPAT_VERSION } = require(\"./util\");\nconst { handleSocket } = require(\"./slave\");\n\n//constants\nconst CHECK_STRING = \"XD_CHECK\";\nconst CHECK_INTERVAL = 100;\n//state\nconst sockets = {};\nlet jsonEncode = true;\n\n//a 'sock' is a two-way event-emitter,\n//each side listens for messages with on()\n//and the other side sends messages with emit()\nexports.createSocket = (id, frame) => {\n  let ready = false;\n  const socket = xhook.EventEmitter(true);\n  sockets[id] = socket;\n  socket.id = id;\n  socket.once(\"close\", function() {\n    socket.destroy();\n    socket.close();\n  });\n  const pendingEmits = [];\n  socket.emit = function(...args) {\n    const extra = typeof args[1] === \"string\" ? ` -> ${args[1]}` : \"\";\n    log(`send socket: ${id}: ${args[0]}${extra}`);\n    args.unshift(id);\n    if (ready) {\n      emit(args);\n    } else {\n      pendingEmits.push(args);\n    }\n  };\n  var emit = function(args) {\n    //convert to string when necessary\n    if (jsonEncode) {\n      args = JSON.stringify(args);\n    }\n    //send!\n    frame.postMessage(args, \"*\");\n  };\n\n  socket.close = function() {\n    socket.emit(\"close\");\n    log(`close socket: ${id}`);\n    sockets[id] = null;\n  };\n\n  socket.once(CHECK_STRING, function(obj) {\n    jsonEncode = typeof obj === \"string\";\n    ready = socket.ready = true;\n    socket.emit(\"ready\");\n    log(`ready socket: ${id} (emit #${pendingEmits.length} pending)`);\n    while (pendingEmits.length) {\n      emit(pendingEmits.shift());\n    }\n  });\n\n  //start checking connectivitiy\n  let checks = 0;\n  var check = () => {\n    // send test message NO ENCODING\n    frame.postMessage([id, CHECK_STRING, {}], \"*\");\n    if (ready) {\n      return;\n    }\n    if (checks++ >= config.timeout / CHECK_INTERVAL) {\n      warn(\"Timeout waiting on iframe socket\");\n      globalEmitter.fire(\"timeout\");\n      socket.fire(\"abort\"); //self-emit \"abort\"\n    } else {\n      log(`check again in ${CHECK_INTERVAL}ms...`);\n      setTimeout(check, CHECK_INTERVAL);\n    }\n  };\n  setTimeout(check);\n\n  log(`new socket: ${id}`);\n  return socket;\n};\n\n//ONE WINDOW LISTENER!\n//double purpose:\n//  creates new sockets by passing incoming events to the 'handler'\n//  passes events to existing sockets (created by connect or by the server)\nexports.initialise = () => {\n  const handle = e => {\n    let d = e.data;\n    //return if not a json string\n    if (typeof d === \"string\") {\n      //only old versions of xdomain send XPINGs...\n      if (/^XDPING(_(V\\d+))?$/.test(d) && RegExp.$2 !== COMPAT_VERSION) {\n        return warn(\n          \"your master is not compatible with your slave, check your xdomain.js version\"\n        );\n        //IE will \"toString()\" the array, this reverses that action\n      } else if (/^xdomain-/.test(d)) {\n        d = d.split(\",\");\n        //this browser must json encode postmessages\n      } else if (jsonEncode) {\n        try {\n          d = JSON.parse(d);\n        } catch (error) {\n          return;\n        }\n      }\n    }\n    //return if not an array\n    if (!(d instanceof Array)) {\n      return;\n    }\n    //return unless lead by an xdomain id\n    const id = d.shift();\n    if (!/^xdomain-/.test(id)) {\n      return;\n    }\n    //finally, create/get socket\n    let socket = sockets[id];\n    //closed\n    if (socket === null) {\n      return;\n    }\n    //needs creation\n    if (socket === undefined) {\n      //send unsolicited requests to the listening server\n      if (!handleSocket) {\n        return;\n      }\n      socket = exports.createSocket(id, e.source);\n      handleSocket(e.origin, socket);\n    }\n    const extra = typeof d[1] === \"string\" ? ` -> ${d[1]}` : \"\";\n    log(`receive socket: ${id}: ${d[0]}${extra}`);\n    //emit data\n    socket.fire.apply(socket, d);\n  };\n  if (document.addEventListener) {\n    return window.addEventListener(\"message\", handle);\n  } else {\n    return window.attachEvent(\"onmessage\", handle);\n  }\n};\n","const xhook = require(\"../vendor/xhook\");\nconst config = require(\"./config\");\nconst { currentOrigin, log, warn, parseUrl, guid, strip } = require(\"./util\");\nconst socketlib = require(\"./socket\");\nconst createSocket = socketlib.createSocket;\n\n//when you add slaves, this node\n//enables master listeners\n\nlet enabled = false;\nlet slaves = {};\n\nexports.addSlaves = newSlaves => {\n  //register master xhook handler\n  if (!enabled) {\n    enabled = true;\n    //unless already set, add withCredentials to xhrs to trick jquery\n    //in older browsers into thinking cors is allowed\n    if (!(\"addWithCredentials\" in xhook)) {\n      xhook.addWithCredentials = true;\n    }\n    //hook XHR calls\n    xhook.before(beforeXHR);\n  }\n  //include the provided set of slave\n  for (let origin in newSlaves) {\n    const path = newSlaves[origin];\n    log(`adding slave: ${origin}`);\n    slaves[origin] = path;\n  }\n};\n\nconfig.slaves = exports.addSlaves;\n\nconst beforeXHR = function(request, callback) {\n  //allow unless we have a slave domain\n  const p = parseUrl(request.url);\n  if (!p || p.origin === currentOrigin) {\n    callback();\n    return;\n  }\n  if (!slaves[p.origin]) {\n    if (p) {\n      log(`no slave matching: '${p.origin}'`);\n    }\n    callback();\n    return;\n  }\n  log(`proxying request to slave: '${p.origin}'`);\n  if (request.async === false) {\n    warn(\"sync not supported because postmessage is async\");\n    callback();\n    return;\n  }\n  //get or insert frame\n  const frame = getFrame(p.origin, slaves[p.origin]);\n  //connect to slave\n  const socket = createSocket(guid(), frame);\n  //queue callback\n  socket.on(\"response\", function(resp) {\n    callback(resp);\n    socket.close();\n  });\n  //user wants to abort\n  request.xhr.addEventListener(\"abort\", () => socket.emit(\"abort\"));\n  //kick off\n  if (socket.ready) {\n    handleRequest(request, socket);\n  } else {\n    socket.once(\"ready\", () => handleRequest(request, socket));\n  }\n};\n\nconst frames = {};\nconst getFrame = function(origin, proxyPath) {\n  //cache origin\n  if (frames[origin]) {\n    return frames[origin];\n  }\n  const frame = document.createElement(\"iframe\");\n  frame.id = frame.name = guid();\n  log(`creating iframe ${frame.id}`);\n  frame.src = `${origin}${proxyPath}`;\n  frame.setAttribute(\"style\", \"display:none;\");\n  document.body.appendChild(frame);\n  return (frames[origin] = frame.contentWindow);\n};\n\nconst convertToArrayBuffer = function(args, done) {\n  const [name, obj] = Array.from(args);\n  const isBlob = instOf(obj, \"Blob\");\n  const isFile = instOf(obj, \"File\");\n  if (!isBlob && !isFile) {\n    return 0;\n  }\n  const reader = new FileReader();\n  reader.onload = function() {\n    // clear value\n    args[1] = null;\n    // formdata.append(name, value, **filename**)\n    if (isFile) {\n      args[2] = obj.name;\n    }\n    return done([\"XD_BLOB\", args, this.result, obj.type]);\n  };\n  reader.readAsArrayBuffer(obj);\n  return 1;\n};\n\n//this FormData is actually XHooks custom FormData `fd`,\n//which exposes all `entries` added, where each entry\n//is the arguments object\nconst convertFormData = function(entries, send) {\n  //expand FileList -> [File, File, File]\n  entries.forEach(function(args, i) {\n    const [name, value] = Array.from(args);\n    if (instOf(value, \"FileList\")) {\n      entries.splice(i, 1);\n      for (let file of Array.from(value)) {\n        entries.splice(i, 0, [name, file]);\n      }\n    }\n  });\n  //basically: async.parallel([filter:files], send)\n  let c = 0;\n  entries.forEach(function(args, i) {\n    c += convertToArrayBuffer(args, function(newargs) {\n      entries[i] = newargs;\n      if (--c === 0) {\n        send();\n      }\n    });\n  });\n  if (c === 0) {\n    send();\n  }\n};\n\nconst handleRequest = function(request, socket) {\n  socket.on(\"xhr-event\", function() {\n    return request.xhr.dispatchEvent.apply(null, arguments);\n  });\n  socket.on(\"xhr-upload-event\", function() {\n    return request.xhr.upload.dispatchEvent.apply(null, arguments);\n  });\n\n  const obj = strip(request);\n  obj.headers = request.headers;\n  //add master cookie\n  if (request.withCredentials) {\n    if (config.cookies.master) {\n      obj.headers[config.cookies.master] = document.cookie;\n    }\n    obj.slaveCookie = config.cookies.slave;\n  }\n\n  const send = () => socket.emit(\"request\", obj);\n\n  if (request.body) {\n    obj.body = request.body;\n    //async serialize formdata\n    if (instOf(obj.body, \"FormData\")) {\n      const { entries } = obj.body;\n      obj.body = [\"XD_FD\", entries];\n      convertFormData(entries, send);\n      return;\n    }\n  }\n  send();\n};\n","const config = require(\"./config\");\nconst { parseUrl } = require(\"./util\");\nconst { addSlaves } = require(\"./master\");\nconst { addMasters } = require(\"./slave\");\nconst { document } = window;\n//auto init using attributes\nexports.initialise = function() {\n  //attribute handlers\n  const attrs = {\n    debug(value) {\n      if (typeof value !== \"string\") {\n        return;\n      }\n      config.debug = value !== \"false\";\n    },\n    slave(value) {\n      if (!value) {\n        return;\n      }\n      const p = parseUrl(value);\n      if (!p) {\n        return;\n      }\n      const s = {};\n      s[p.origin] = p.path;\n      addSlaves(s);\n    },\n    master(value) {\n      let p;\n      if (!value) {\n        return;\n      }\n      if (value === \"*\") {\n        p = { origin: \"*\", path: \"*\" };\n      } else if (value === \"file://*\") {\n        p = { origin: \"file://\", path: \"*\" };\n      } else {\n        p = parseUrl(value);\n      }\n      if (!p) {\n        return;\n      }\n      const m = {};\n      m[p.origin] = p.path.replace(/^\\//, \"\") ? p.path : \"*\";\n      addMasters(m);\n    }\n  };\n  //find all script tags referencing 'xdomain' and then\n  //find all attributes with handlers registered\n  for (let script of Array.from(document.getElementsByTagName(\"script\"))) {\n    if (/xdomain/.test(script.src)) {\n      for (let prefix of [\"\", \"data-\"]) {\n        for (let k in attrs) {\n          const fn = attrs[k];\n          fn(script.getAttribute(prefix + k));\n        }\n      }\n    }\n  }\n};\n","\"use strict\";\n\n//feature detect\nconst { warn } = require(\"./lib/util\");\nfor (let feature of [\"postMessage\", \"JSON\"]) {\n  if (!window[feature]) {\n    warn(`requires '${feature}' and this browser does not support it`);\n  }\n}\n\n//init socket (post message mini-library)\nconst socket = require(\"./lib/socket\");\nsocket.initialise();\n\n//initialise script (load config from script tag)\nconst script = require(\"./lib/script\");\nscript.initialise();\n\n//public api\nconst initialise = require(\"./lib/config\");\n//config is also the primary intialise function\nmodule.exports = initialise;\n","const xhook = require(\"./vendor/xhook\");\nwindow.xhook = xhook;\nconst xdomain = require(\"./index\");\nwindow.xdomain = xdomain;\n"]}