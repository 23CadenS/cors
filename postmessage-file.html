<html>
<head>
  <title></title>
</head>
<body>
  
<script type="text/javascript">

if(window === window.parent) {
  window.addEventListener("message", function(event) {
    console.log(event.origin, event.data);
  })
  document.write("<iframe src='http://127.0.0.1:3000/postmessage-file.html'></iframe>");
} else {

  function send(obj) {
    window.parent.postMessage(obj, "*");
  }

  // var arr = new Uint8Array(42);
  // arr[13] = 260;
  // send(arr);

  // var blob = new Blob(["foo"], {type:'text/plain'});
    


  document.write("<input type='file' id='files' name='files[]' multiple /><output id='list'></output>");
  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object


    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {

      try {
        send(f)  
      } catch(err) {
        console.log('cant send')
      }
      

      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }
  document.getElementById('files').addEventListener('change', handleFileSelect, false);
}

</script>
</body>
</html>